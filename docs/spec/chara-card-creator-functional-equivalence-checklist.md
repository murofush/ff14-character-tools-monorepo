# Chara Card Creator 機能同等チェックリスト（旧実装基準）

## ステータス

- 状態: Confirmed
- 決定日: 2026-02-12

## 目的/背景

- React 移行時に「機能だけ完全移植」を判定するため、旧実装基準の確認項目を明文化する。
- UI 見た目差異は許容し、操作結果・状態遷移・出力結果の同等性を評価対象とする。

## 仕様

1. 評価方針
- 判定単位は `画面 / 操作 / 期待結果` とする。
- 期待結果には表示だけでなく、ストア状態・API呼び出し・副作用を含める。
- 各項目は以下ステータスで運用する。
  - `未着手`
  - `実装済`
  - `手動確認済`
  - `差分あり（要仕様合意）`

2. 前提条件
- Tag/Patch/Achievement 基本データが読込可能である。
- `/api/get_character_info` が呼び出せる。
- localStorage と `ENCRYPT_KEY` による復元が機能する。

## 受け入れ条件

- Must 項目がすべて `手動確認済` である。
- 差分項目がある場合、仕様書に事前合意が記録されている。

## 非ゴール

- Vuetify 固有DOMや見た目の一致。
- 旧実装の内部構造コピー。

## 影響範囲

- Front / Back / Domain / Docs（移行判定全体）

## 既存挙動との差分

- なし（旧実装の確認観点を明文化したもの）。

## 移行/互換方針

- 本チェックリストを満たさない状態で旧実装を削除しない。
- 差分導入時は仕様変更を先に確定する。

## チェックリスト

### A. 共通レイアウト・導線

- [ ] ヘッダに `キャラクター選択 / アチーブメント選択 / 名刺デザイン編集` 導線が表示される。
- [ ] キャラクター取得後にヘッダのキャラクター情報メニューが表示される。
- [ ] 共通スナックバーで成功/失敗メッセージを表示できる。
- [ ] フッタの問い合わせフォーム導線と `/about` 導線が表示される。

### B. Home（`/`）

- [ ] Lodestone URL/ID 入力の必須・形式バリデーションが機能する。
- [ ] 数値ID入力時に URL 正規化して取得できる。
- [ ] 取得成功時に `CharacterInfoStore` が更新される。
- [ ] キャラクターID変更時に選択済み実績がリセットされる。
- [ ] `syncAchievements` 実行後に `/selectAchievement` へ遷移する。
- [ ] 直近取得キャラクターカードから再開できる。

### C. キャラクター取得 API（`/api/get_character_info`）

- [ ] URL未指定時に400で `url_invalid` を返す。
- [ ] 不正URL時に400で `url_invalid` を返す。
- [ ] 正常時に `ResponseData` 形式を返す。
- [ ] 実績非公開時に `isAchievementPrivate=true` で返却できる。
- [ ] FC情報取得失敗時にエラーが通知される。

### D. アチーブメント選択（`/selectAchievement`）

- [ ] キャラクター未取得時は `/` へ戻る。
- [ ] `KIND` タブ切替でカテゴリ一覧が切り替わる。
- [ ] カテゴリ未取得時に遅延取得が実行される。
- [ ] 取得失敗時に再取得導線が機能する。
- [ ] モバイルでグループナビドロワーを開閉できる。

### E. 実績カード選択ルール

- [ ] `isCompleted=false` のカードは選択不可である。
- [ ] 選択時に `AchievementIndexPath` が追加される。
- [ ] 再クリックで選択解除される。
- [ ] 上限4件超過時にエラー通知される。
- [ ] 重複選択時にエラー通知される。

### F. 選択済み一覧パネル

- [ ] 選択件数が `現在件数 / 4` で表示される。
- [ ] 各項目のコンテキストメニューから削除できる。
- [ ] Back（`/`）と Next（`/editCharaCard`）導線が機能する。
- [ ] 件数0/1以上でパネル開閉状態が同期される。

### G. カード編集（`/editCharaCard`）

- [ ] 画像アップロード後にトリミングダイアログが開く。
- [ ] 9:16 / 16:9 のトリミング比率切替が機能する。
- [ ] 全画面表示/左右配置/表示範囲スライダーが反映される。
- [ ] 紹介文編集がプレビューへ反映される。
- [ ] テーマ切替と配色上書きが反映される。
- [ ] フォント（名前/全体/英数字専用）設定が反映される。
- [ ] 緩和前取得実績の強調表示制御が機能する。

### H. 画像保存

- [ ] メイン画像未設定時は保存拒否とエラー通知になる。
- [ ] 保存時に `chara_card.png` がダウンロードされる。
- [ ] 画像サイズが大きいケースでも保存処理が完了する。

### I. ストア・復元

- [ ] `ResponseData` が暗号化して localStorage 保存される。
- [ ] 再訪時に復元される。
- [ ] 不正データ復元時はストレージを破棄して継続できる。
- [ ] `SelectedCharaInfoStore` の主要設定（テーマ/フォント/色/画像）が反映される。

### J. エラー通知

- [ ] API失敗時にユーザー向けメッセージが表示される。
- [ ] Lodestone未検出時に「ユーザーが見つからない」旨が表示される。
- [ ] 内部エラー時に `OUTPUT_SNACKBAR` が一貫して動作する。

## 関連リンク

- `docs/spec/chara-card-creator-product-charter.md`
- `docs/spec/chara-card-creator-legacy-screen-responsibilities.md`
- `docs/spec/chara-card-creator-legacy-api-data-contract.md`
- `apps/chara-card-creator/pages/`
- `apps/chara-card-creator/components/`
- `apps/chara-card-creator/store/`
- `apps/chara-card-creator/api/`
